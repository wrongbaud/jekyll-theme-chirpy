<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="theme" content="Chirpy v2.5.1"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking" /><meta name="author" content="wrongbaud" /><meta property="og:locale" content="en_US" /><meta name="description" content="Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation and Password Cracking" /><meta property="og:description" content="Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation and Password Cracking" /><link rel="canonical" href="https://wrongbaud.github.io/posts/kong-vs-ghidra/" /><meta property="og:url" content="https://wrongbaud.github.io/posts/kong-vs-ghidra/" /><meta property="og:site_name" content="Wrongbaud’s Blog" /><meta property="og:image" content="https://wrongbaud.github.io/" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-04-23T08:06:31+08:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://wrongbaud.github.io/" /><meta property="twitter:title" content="Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking" /><meta name="twitter:site" content="@wrongbaud" /><meta name="twitter:creator" content="@wrongbaud" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"description":"Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation and Password Cracking","@type":"BlogPosting","headline":"Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking","dateModified":"2021-04-23T08:06:31+08:00","url":"https://wrongbaud.github.io/posts/kong-vs-ghidra/","datePublished":"2021-04-23T08:06:31+08:00","image":"https://wrongbaud.github.io/","mainEntityOfPage":{"@type":"WebPage","@id":"https://wrongbaud.github.io/posts/kong-vs-ghidra/"},"author":{"@type":"Person","name":"wrongbaud"},"@context":"https://schema.org"}</script><title>Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking | Wrongbaud's Blog</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="cdn.jsdelivr.net"><link rel="dns-prefetch" href="cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css" integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous"><link rel="preload" as="style" href="/assets/css/post.css"><link rel="stylesheet" href="/assets/css/post.css"><link rel="preload" as="style" href="/assets/css/lib/bootstrap-toc.min.css"><link rel="stylesheet" href="/assets/css/lib/bootstrap-toc.min.css" /> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="/assets/js/post.min.js"></script> <script defer src="/app.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column"><div id="nav-wrapper"><div id="profile-wrapper" class="d-flex flex-column"><div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img src="https://i2.wp.com/wasistdas.co.uk/Owlsploitation/wp-content/uploads/2011/05/bubo2.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="profile-text mt-3"><div class="site-title"> <a href="/">Wrongbaud's Blog</a></div><div class="site-subtitle font-italic">Hardware / Software Reverse Engineering</div></div></div><ul class="nav flex-column"><li class="nav-item d-flex justify-content-center "> <a href="/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/categories/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/tags/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/archives/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item d-flex justify-content-center "> <a href="/tabs/about/" class="nav-link d-flex justify-content-center align-items-center w-100"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul></div><div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <span id="mode-toggle-wrapper"> <i class="mode-toggle fas fa-sun" dark-mode-invisible></i> <i class="mode-toggle fas fa-moon" light-mode-invisible></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.mode != null) { if (this.mode == ModeToggle.DARK_MODE) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.mode != null) { if (self.mode == ModeToggle.DARK_MODE) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span> <span class="icon-border"></span> <a href="https://github.com/wrongbaud" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/wrongbaud" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['wrongbaud','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking</h1><div class="post-meta text-muted d-flex flex-column"><div> Posted <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 23, 2021, 8:06 AM +0800" > Apr 23 <i class="unloaded">2021-04-23T08:06:31+08:00</i> </span> by <span class="author"> wrongbaud </span></div><div> Updated <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Fri, Apr 23, 2021, 8:05 AM -0400" > Apr 23 <i class="unloaded">2021-04-23T20:05:06+08:00</i> </span></div></div><div class="post-content"> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="" class="post-preview-img"><h1 id="godzilla-vs-kong-vs--ghidra---ghidra-scripting-pcode-emulation-and-password-cracking-on-a-gba-rom">Godzilla Vs. Kong Vs … Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking on a GBA ROM</h1><h2 id="overview">Overview</h2><p>This month Godzilla Vs. Kong is being released. As a long-time Toho/kaiju fan, I thought it would only be appropriate to size up these two monsters against Ghidra! Over the next few months, we will be reverse engineering various King Kong and Godzilla games to see how well they hold up against an additional opponent, Ghidra!</p><p>To start, we’re going to be reverse-engineering the Game Boy Advance (GBA) game Kong: King of Atlantis. This game utilizes a password system to get access to the various levels. We will be reverse engineering that functionality and hopefully putting together some scripts to aid in our analysis! Can King Kong hold his own against Ghidra’s monstrous API? Let’s find out.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/kvg.jpg" alt="Password Screen" /></p><h3 id="reccomended-reading">Reccomended Reading</h3><ul><li>If you’re not familiar with ARM/Thumb operating modes, I would highly recommend that you review <a href="https://www.embedded.com/introduction-to-arm-thumb/">this post</a>.<li>If you would like to follow along, you will need to get your <a href="https://wrongbaud.github.io/posts/ghidra-debugger/">Ghidra development environment set up correctly</a>.</ul><h2 id="goals">Goals</h2><p>In this post, I want to demonstrate and explain the following:</p><ol><li>Using pre-existing Ghidra scripts to aid in your analysis<li>Writing your own scripts to automate analysis tasks<li>Utilize and emulate Ghidra’s intermediate language PCode to aid in your analysis<li>How to crack some GBA passwords!</ol><p>Kong: King of Atlantis is a side-scrolling action game released for the Game Boy Advance in 2005. It allowed you to play as various characters from the cartoon and utilized a password system for accessing levels. Passwords were displayed at the end of each level and could be entered from the password screen:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/good_job_pw_screen.png" alt="Password Screen" /></p><h2 id="initial-rom-analysis">Initial ROM Analysis</h2><p>After our <a href="https://wrongbaud.github.io/posts/ghidra-debugger/">last post</a> we now have a loader for GBA ROMs and the ability to debug them using an emulator/gdb.</p><p>First, we will load the Kong: King of Atlantis ROM and select the GBA loader. After running autoanalysis, we can see that Ghidra has defined a large number of functions for us:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/function_count.png" alt="Functions Automatically Found" /></p><p>If we take a cursory look through all of these functions, we can see that most of them have a similar function prologue:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/func_pro_2.png" alt="Function Prologue Two" /></p><p>From this, we can infer a couple of things about this codebase:</p><ul><li>A large amount of this code seems to be operating in <a href="https://www.cs.umd.edu/~meesh/cmsc411/website/proj01/arm/thumb.html">ARM’s Thumb mode</a><li>Most of these functions seem to begin with the same function prologue</ul><p>While Ghidra did an excellent job at identifying many functions, we can still see some locations where autoanalysis stopped and could not define code/functions.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/example_undefined_function.png" alt="Undefined Function" /></p><p>If we attempt to disassemble this data as THUMB code, we see the following appear:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/proper_disassembly.png" alt="Proper Disassembly" /></p><p>Some segments of the ROM remain unanalyzed and could contain code that we are interested in. Given that there remains a decent amount of undefined code, we have two options here moving forward to complete our analysis:</p><ol><li>We can search for byte sequences / undefined code regions and create them manually<li>We can search for byte/instruction sequences that match the <code class="language-plaintext highlighter-rouge">push</code> instruction and attempt to automate function discovery<ul><li><strong>Note</strong>: Just because we are seeing many functions utilizing Thumb mode and beginning with a <code class="language-plaintext highlighter-rouge">push</code> instruction does not mean that <em>all</em> of the functions will be like this. We are simply trying to automate what we have already observed, so these methods may still leave some functions undefined</ul></ol><p>Option one will certainly work but will take some time and will not assist us when we inevitably run into this again when reversing other GBA ROMs. If performed correctly, option two will result in a repeatable analysis tool and allow us to dive into Ghidras API as well, so let’s go with option two.</p><p>Before writing our own tool to do this, we should check and see if someone has already done something similar. Let’s take a look at Ghidra’s Script manager.</p><h2 id="ghidra-scripting-and-script-manager">Ghidra Scripting and Script Manager</h2><p>Ghidra’s API supports both Java and Python. You can find examples of each in Ghidra’s script manager. When attempting to automate or create a new Ghidra script, it is always good to review the existing scripts. If we cannot find what we need, we can likely find something that illustrates portions of what we want to do. We can do this by clicking on the <code class="language-plaintext highlighter-rouge">Window</code> -&gt; <code class="language-plaintext highlighter-rouge">Script Manager</code> doing so will bring up the following window:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/script_window.png" alt="Script Window" /></p><p>If we look at the tree in the left of the scripts window, we can see that the scripts are categorized. Let’s start by taking a look at the Functions option and see what already been developed for us:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/script_window_functions.png" alt="Script Window Functions" /></p><p><strong>RE Tip:</strong> Always check the scripts included in Ghidra when you’re attempting to write a new analysis feature. There is nothing wrong with standing on the shoulders of other folks when doing RE (or any kind of work).</p><p>Sure enough, there is a script called <code class="language-plaintext highlighter-rouge">MakeFunctionsScript.java</code> the description is as follows:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>Script to ask the user for a byte sequence that is a common function start  make functions at those locations  if code has only one block it asks the user where the data block is and splits the program into  code and data blocks  
</pre></table></code></div></div><p>This is very close to what we need, so let’s give it a try using the bytes: <code class="language-plaintext highlighter-rouge">0x30 0xB5</code> this is the machine code for the instruction: <code class="language-plaintext highlighter-rouge">push { r4, r5, lr }</code>.</p><p>If we double click on this script, the following window appears:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/script_arguments.png" alt="Script Arguments" /></p><p>After providing our byte sequence and running the script, we see the following lines of output in the console window:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre>MakeFunctionsScript.java&gt; Function already exists at address: 082c44a0
MakeFunctionsScript.java&gt; Function already exists at address: 082c4918
MakeFunctionsScript.java&gt; Function already exists at address: 082c53d4
MakeFunctionsScript.java&gt; Made function at address: 082c556c
MakeFunctionsScript.java&gt; Function already exists at address: 082c604c
MakeFunctionsScript.java&gt; Made function at address: 082c6138
</pre></table></code></div></div><p>Excellent! Just by searching the script repository, we were able to find another way to streamline our analysis. Let’s take a look at some of the newly defined functions and see what they look like:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/bad_function_data_section.png" alt="Bad Function 1" /></p><p>If we try to disassemble this manually in ARM mode, no assembly is generated. If we disassemble it in Thumb mode, we see the following:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/bad_disassembly.png" alt="Bad Disassembly" /></p><p>While this sequence of bytes disassembles, this does not look like valid code. To those of you who are new to RE, this may seem a little ambiguous. How do we know that this probably isn’t valid code? Some things to look for when determining whether disassembly is valid or not include:</p><ul><li>Is a clear entry point present? (Look for a function prologue such as a <code class="language-plaintext highlighter-rouge">push</code> instruction, etc.)<li>Is a return instruction or method present?<li>Are any instructions repeated with identical arguments (e.g.: <code class="language-plaintext highlighter-rouge">MOV r0, r0</code>)<li>Is this code segment surrounded (or close to) valid code?<li>Are there any references to this code segment anywhere? (XREFs, jump tables, etc.)</ul><p>We don’t see any of these characteristics in the snippet posted above! So this is probably not valid code, but what is it? If we scroll up in the database, we come across strings of increasing characters like this:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/characters.png" alt="Bad Disassembly" /></p><p>What might this data be? Remember that we’re analyzing an entire Game Boy Advance Rom, so this data could be used to draw sprites, play audio, etc. In addition to code, there are tons of resources packed into this ROM, like sprites and audio files! Let’s see if we can look at this ROM and determine where some of this data is located to tell our function analysis plugin to ignore these regions. If we look at the functions that have been defined thus far, we see a gap in the addresses:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/function_gap.png" alt="Function Gap" /></p><p>If we look at what is contained within this gap, some patterns can be found. Take this byte sequence, for example:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/bad_bytes.png" alt="Bad Bytes" /></p><p>If we try to disassemble these bytes, we get the following:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/bad_bytes_disassembled.png" alt="Bad Bytes" /></p><p>Let’s revisit the superficial criteria that we came up with earlier to determine if a byte sequence contained valid code or not:</p><ul><li>~<del>Is a clear entry point present? (Look for a function prologue such as a <code class="language-plaintext highlighter-rouge">push</code> instruction, etc.)</del>~<li>~<del>Is a return instruction or method present?</del>~<li>~<del>Is this code segment surrounded (or close to) valid code?</del>~<li>~<del>Are there any references to this code segment anywhere? (XREFs, jump tables, etc.)</del>~</ul><p>It’s not looking great for this segment. If we continue to review this range manually, we find other elements of interesting data such as:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/bad_bytes_3.png" alt="Bad Bytes" /></p><p>At this point, you’re probably wondering what all of this extra data might be. Remember that this is an entire GBA ROM image. These images typically didn’t contain any kind of filesystem for resource management or things of that nature, so the game’s resources needed to be embedded into the ROM! This range could represent map data, tile data, audio effects, or any other in-game asset. For now, we are going to have our analysis script ignore the region between <code class="language-plaintext highlighter-rouge">0x3BDC</code> and <code class="language-plaintext highlighter-rouge">0x2B42b0</code>.</p><p>While I don’t want to do a line by line code review, I do want to highlight some of the more helpful API calls that the provided <code class="language-plaintext highlighter-rouge">MakeFunctionsScript.java</code> script takes advantage of:</p><ol><li><code class="language-plaintext highlighter-rouge">currentProgram.getMemory()</code> - Returns the memory space of the program being analyzed<li><code class="language-plaintext highlighter-rouge">askBytes()</code> - This function returns a sequence of bytes provided by the user<li><code class="language-plaintext highlighter-rouge">currentProgram.getMemory().getBlocks()</code> - Returns an array of <code class="language-plaintext highlighter-rouge">MemoryBlock</code> objects that represent the memory map of the target binary<li><code class="language-plaintext highlighter-rouge">memory.findBytes(start, end, functionBytes, null, true, monitor)</code> - Searches the memory space for the provided byte sequence<li><code class="language-plaintext highlighter-rouge">getFunctionContaining(found)</code> - Returns the function that contains the address <code class="language-plaintext highlighter-rouge">found</code><li><code class="language-plaintext highlighter-rouge">disassemble(found)</code> - Attempts to disassemble code at the provided address <code class="language-plaintext highlighter-rouge">found</code></ol><p>We will need to understand how these work to modify the behavior to fit our use case, so with that - let’s try to write our own version of this script that will work on this GBA ROM.</p><h3 id="writing-custom-scripts">Writing Custom Scripts</h3><p>At this point, we can manually run this script with new byte sequences to try to identify additional functions, but what if we could just edit this existing script to iterate over multiple byte sequences and disassemble where the byte sequence is found?</p><p>Using the script manager, we can edit this pre-existing script by right-clicking it and selecting: <code class="language-plaintext highlighter-rouge">Edit with basic editor</code> doing this opens up a simple editor:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/basic_editor.png" alt="Basic Editor" /></p><p>As you might have noticed, some of the code that gets disassembled by this script is <em>not</em> in thumb mode. Look at the following byte sequence, for example:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/example_undefined_function.png" alt="Undefined Function Example" /></p><p>If we disassemble this sequence of bytes using the <code class="language-plaintext highlighter-rouge">disassemble</code> API call, we see the following assembly as a result:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/improper_disassembly.png" alt="Improper Disassembly" /></p><p>While these are technically properly disassembled ARM instructions, they’re not being disassembled in the correct mode. If we manually disassemble this byte sequence in Thumb mode, we see the following:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/proper_disassembly.png" alt="Proper Disassembly" /></p><p>Now, this looks much better! We even have a branch instruction that jumps to a previously defined function. This is a sign that we selected the proper mode.</p><p>Now that we have an idea of how this script works and how we need to change it to suit our use case, we need to modify the function finder script to:</p><ol><li>Locate our specified sequence of bytes that represent a <code class="language-plaintext highlighter-rouge">push</code> instruction<li>Attempt to generate Thumb mode code at said address</ol><p>Earlier, we tried to use the <code class="language-plaintext highlighter-rouge">disassemble()</code> API call to create code, but that generated ARM instructions. After looking through the included scripts with Ghidra, I found an example of generating Thumb code. You can find it below:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>Address found = parseAddress("0x8000b58");
// We set the true flag here to disassembly in Thumb mode
ArmDisassembleCommand cmd = new ArmDisassembleCommand(found,null,true);
// Apply the command and as a result, perform the disassembly
cmd.applyTo(currentProgram);
</pre></table></code></div></div><p>Now that we can create Thumb mode code, we can modify the pre-existing <code class="language-plaintext highlighter-rouge">MakeFunctionsScript.java</code> program to look for <code class="language-plaintext highlighter-rouge">push</code> instructions and disassembly the bytes in thumb mode where these byte sequences are found. But remember, we’d like to see all instances of this push instruction (or at least as many as we can) without having to continually run this script.</p><p>The 16 bit <code class="language-plaintext highlighter-rouge">push</code> instruction is encoded as follows:</p><div class="table-wrapper"><table><thead><tr><th>Bit<th>Value<tbody><tr><td>15<td>1<tr><td>14<td>0<tr><td>13<td>1<tr><td>12<td>1<tr><td>11<td>0<tr><td>10<td>1<tr><td>9<td>0<tr><td>8<td>X (Used for LR)<tr><td>7<td>R7<tr><td>6<td>R6<tr><td>5<td>R5<tr><td>4<td>R4<tr><td>3<td>R3<tr><td>2<td>R2<tr><td>1<td>R1<tr><td>0<td>R0</table></div><p>This means that we want to look for all byte sequences that share the upper 6 bits of the table above, allowing for all possible register configurations to be decoded if they are found. Is this overkill? – Yes,, but it makes an excellent example of how to try to automate some of the manual aspects of reverse engineering a ROM file like this. We will modify the existing Ghidra plugin to iterate over these byte sequences and create Thumb mode code when these values are found.</p><p>We want to write this so that we can use it on other GBA ROMs in the future, so the first thing that I would like this script to do is ask the user for a region of memory to perform analysis on, we can do that with the following function:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="c1">// Give the user an option to choose a start address and end address for the script</span>
<span class="kd">public</span> <span class="nc">Address</span><span class="o">[]</span> <span class="nf">getBlockInfo</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">regionCount</span> <span class="o">=</span> <span class="n">askInt</span><span class="o">(</span><span class="s">"Get Num of Regions"</span><span class="o">,</span><span class="s">"How many different memory regions would you like to analyze?"</span><span class="o">);</span>
    <span class="nc">Address</span> <span class="o">[]</span> <span class="n">blocks</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Address</span><span class="o">[</span><span class="n">regionCount</span><span class="o">*</span><span class="mi">2</span><span class="o">];</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">regionCount</span><span class="o">;</span> <span class="n">x</span><span class="o">+=</span><span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Address</span> <span class="n">startAddress</span> <span class="o">=</span> <span class="n">askAddress</span><span class="o">(</span><span class="s">"Get Start Address"</span><span class="o">,</span><span class="s">"Please enter the starting address of the region you wish to analyze"</span><span class="o">);</span>
        <span class="nc">Address</span> <span class="n">endAddress</span> <span class="o">=</span> <span class="n">askAddress</span><span class="o">(</span><span class="s">"Get End Address"</span><span class="o">,</span><span class="s">"Please enter the end address for the region you wish to analyze"</span><span class="o">);</span>
        <span class="n">blocks</span><span class="o">[</span><span class="n">x</span><span class="o">]</span> <span class="o">=</span> <span class="n">startAddress</span><span class="o">;</span>
        <span class="n">blocks</span><span class="o">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="o">]</span> <span class="o">=</span> <span class="n">endAddress</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="n">blocks</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>There are only a few API calls being used in the above loop:</p><ol><li><code class="language-plaintext highlighter-rouge">askInt()</code> - Similar to the <code class="language-plaintext highlighter-rouge">askByte()</code> function we reviewed earlier<li><code class="language-plaintext highlighter-rouge">askAddress()</code> - See above description</ol><p>We use this subroutine to define the regions that we want to perform the analysis. The analysis loop can be seen below:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre><td class="rouge-code"><pre><span class="c1">// Using the provided byte sequence and address range, iterate over the addresses and look for instructions!</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getFunctions</span><span class="o">(</span><span class="nc">Address</span> <span class="n">start</span><span class="o">,</span><span class="nc">Address</span> <span class="n">end</span><span class="o">,</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">inst_sequence</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">funcCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">boolean</span> <span class="n">keepSearching</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
    <span class="c1">// Let the user know which byte sequence we are looking for.</span>
    <span class="n">print</span><span class="o">(</span><span class="s">"Searching for byte sequence: "</span> <span class="o">);</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">byte</span> <span class="nl">b:</span> <span class="n">inst_sequence</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">print</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">format</span><span class="o">(</span><span class="s">"%02X"</span><span class="o">,</span> <span class="n">b</span><span class="o">));</span>
    <span class="o">}</span>
    <span class="n">println</span><span class="o">(</span><span class="s">""</span><span class="o">);</span>
    <span class="c1">// Get the memory space for the current program that we are analyzing.</span>
    <span class="nc">Memory</span> <span class="n">memory</span> <span class="o">=</span> <span class="n">currentProgram</span><span class="o">.</span><span class="na">getMemory</span><span class="o">();</span>
    <span class="nc">Address</span> <span class="n">currentAddr</span> <span class="o">=</span> <span class="n">start</span><span class="o">;</span>
    <span class="k">while</span><span class="o">(</span><span class="n">keepSearching</span> <span class="o">&amp;&amp;</span> <span class="o">(!</span><span class="n">monitor</span><span class="o">.</span><span class="na">isCancelled</span><span class="o">())&amp;&amp;</span> <span class="o">(</span><span class="n">start</span><span class="o">.</span><span class="na">compareTo</span><span class="o">(</span><span class="n">end</span><span class="o">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="o">))</span> <span class="o">{</span>
        <span class="c1">// Search the memory region that we provided for our byte sequence</span>
        <span class="nc">Address</span> <span class="n">found</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="na">findBytes</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">,</span> <span class="n">inst_sequence</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">monitor</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(</span><span class="n">found</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
            <span class="k">if</span><span class="o">(</span><span class="n">getFunctionContaining</span><span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//Create our command to disassemble code in thumb mode</span>
                <span class="nc">ArmDisassembleCommand</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArmDisassembleCommand</span><span class="o">(</span><span class="n">found</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="kc">true</span><span class="o">);;</span>
                <span class="n">cmd</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">currentProgram</span><span class="o">);</span>
                <span class="k">if</span><span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="na">getDisassembledAddressSet</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                    <span class="c1">// Code was properly disassembled, create a function!</span>
                    <span class="nc">Function</span> <span class="n">func</span> <span class="o">=</span> <span class="n">createFunction</span><span class="o">(</span><span class="n">found</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
                    <span class="k">if</span> <span class="o">(</span><span class="n">func</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">println</span><span class="o">(</span><span class="s">"Made function at address: "</span> <span class="o">+</span> <span class="n">found</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
                        <span class="c1">// Add the length of our function here so that we don't have to iterate through all of the created code.</span>
                        <span class="n">start</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">func</span><span class="o">.</span><span class="na">getBody</span><span class="o">().</span><span class="na">getNumAddresses</span><span class="o">());</span>
                        <span class="n">funcCount</span><span class="o">++;</span>
                        <span class="k">break</span><span class="o">;</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
        <span class="c1">// Nothing was found with memory.findBytes, time to bail!</span>
        <span class="o">}</span><span class="k">else</span> <span class="o">{</span>
            <span class="n">keepSearching</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>		
    <span class="k">return</span> <span class="n">funcCount</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>So, what exactly is going on in the above loop? We provide a start and end address for the analysis and a byte sequence to search for. From there, we take advantage of the <code class="language-plaintext highlighter-rouge">findBytes</code> function, which will return addresses containing the provided byte sequence.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nc">Address</span> <span class="n">found</span> <span class="o">=</span> <span class="n">memory</span><span class="o">.</span><span class="na">findBytes</span><span class="o">(</span><span class="n">start</span><span class="o">,</span> <span class="n">end</span><span class="o">,</span> <span class="n">inst_sequence</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="n">monitor</span><span class="o">);</span>
</pre></table></code></div></div><p>If a proper byte sequence is found, we check to see if it is already in a function. If not, we attempt to disassemble THUMB mode code at that address.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">if</span><span class="o">(</span><span class="n">found</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="k">if</span><span class="o">(</span><span class="n">getFunctionContaining</span><span class="o">(</span><span class="n">found</span><span class="o">)</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//Create our command to disassemble code in thumb mode</span>
        <span class="nc">ArmDisassembleCommand</span> <span class="n">cmd</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArmDisassembleCommand</span><span class="o">(</span><span class="n">found</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="kc">true</span><span class="o">);;</span>
        <span class="n">cmd</span><span class="o">.</span><span class="na">applyTo</span><span class="o">(</span><span class="n">currentProgram</span><span class="o">);</span>
</pre></table></code></div></div><p>If the code is disassembled correctly, we create a function and add the length of that function to our current address.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">if</span><span class="o">(</span><span class="n">cmd</span><span class="o">.</span><span class="na">getDisassembledAddressSet</span><span class="o">()</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
    <span class="c1">// Code was properly disassembled, create a function!</span>
    <span class="nc">Function</span> <span class="n">func</span> <span class="o">=</span> <span class="n">createFunction</span><span class="o">(</span><span class="n">found</span><span class="o">,</span> <span class="kc">null</span><span class="o">);</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">func</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">println</span><span class="o">(</span><span class="s">"Made function at address: "</span> <span class="o">+</span> <span class="n">found</span><span class="o">.</span><span class="na">toString</span><span class="o">());</span>
        <span class="c1">// Add the length of our function here so that we don't have to iterate through all of the created code.</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">found</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">func</span><span class="o">.</span><span class="na">getBody</span><span class="o">().</span><span class="na">getNumAddresses</span><span class="o">());</span>
        <span class="n">funcCount</span><span class="o">++;</span>
        <span class="k">break</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>Finally we will tie both of these together in the <code class="language-plaintext highlighter-rouge">run()</code> function as follows:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"GBA Function Generation"</span><span class="o">);</span>
    <span class="kt">int</span> <span class="n">foundCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kt">byte</span> <span class="o">[]</span> <span class="n">inst_bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[]</span> <span class="o">{</span><span class="mh">0x00</span><span class="o">,(</span><span class="kt">byte</span><span class="o">)</span><span class="mh">0xB5</span><span class="o">};</span>
    <span class="nc">Address</span><span class="o">[]</span> <span class="n">addrBlocks</span> <span class="o">=</span> <span class="n">getBlockInfo</span><span class="o">();</span>
    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">inst_byte</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">inst_byte</span><span class="o">&lt;</span> <span class="mh">0xFF</span><span class="o">;</span><span class="n">inst_byte</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">x</span><span class="o">&lt;</span> <span class="n">addrBlocks</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">inst_bytes</span><span class="o">[</span><span class="mi">0</span><span class="o">]</span> <span class="o">=</span> <span class="o">(</span><span class="kt">byte</span><span class="o">)</span><span class="n">inst_byte</span><span class="o">;</span>
            <span class="n">foundCount</span> <span class="o">+=</span> <span class="n">getFunctions</span><span class="o">(</span><span class="n">addrBlocks</span><span class="o">[</span><span class="n">x</span><span class="o">],</span><span class="n">addrBlocks</span><span class="o">[</span><span class="n">x</span><span class="o">+</span><span class="mi">1</span><span class="o">],</span><span class="n">inst_bytes</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"Made "</span><span class="o">+</span><span class="n">foundCount</span><span class="o">+</span> <span class="s">" functions"</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>After running this script and providing the previously mentioned regions, we generate 141 additional functions! Not bad for a few lines of Java that we borrowed from a pre-existing script.</p><h2 id="hunting-for-kongs-passwords">Hunting for Kong’s Passwords</h2><p>Now that we have a fair amount of functions analyzed let’s see if we can track down the code that is handling the processing of the passwords. Let’s start by exploring what we know of the password system:</p><ol><li>Passwords are made up of 7 characters<li>Passwords are only letters, and 17 possible values can be used<li>Passwords are immediately parsed after 7 characters are entered</ol><p>We can start by looking for instructions that contain the immediate value 7. We can also see if there are any usable string references in the ROM. Let’s start by looking for instructions containing the value 7. This can be done by navigating to <code class="language-plaintext highlighter-rouge">Search -&gt; For Scalars</code> window from the top navigation bar. From this window, we will input the value 7 and click search; this causes the following window to appear:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/7_search.png" alt="Scalar Search" /></p><p>There are 372 results, but only a handful of them utilize <code class="language-plaintext highlighter-rouge">cmp</code> instructions. The hypothesis here is that as you enter the password, a counter is incrementing with each character (notice that there is no “enter” button at the password screen and automatically parses the password after seven characters). After searching through the results containing a <code class="language-plaintext highlighter-rouge">cmp</code> with the value 7, we come across the function <code class="language-plaintext highlighter-rouge">FUN_082ca72e</code> that contains the following:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">in_stack_0000000c</span> <span class="o">&lt;</span> <span class="mh">0x1e</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"Wrong PassWord"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
    <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"              "</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Alright, it looks like we are probably on the right track here; let’s see what other functions this subroutine calls. We can do this in Ghidra by looking at the call tree. With the function selected in the decompiler window, click on the <code class="language-plaintext highlighter-rouge">Window</code> button in the navigation bar, and then click <code class="language-plaintext highlighter-rouge">Function Call Trees</code>, the following window will appear:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/function_call_tree.png" alt="Function Call Tree" /></p><p>This window contains two tables:</p><ol><li>Incoming Calls - These are the functions that call this function<li>Outgoing Calls - These are the function that this function calls</ol><p>Before we dive too deep into the functions that this function calls, let’s see if we can better understand what is going on. Remember that we navigated to this function because we saw a comparison against the immediate value 7. That comparison can be seen code segment extracted from the function below (be warned, it’s a pretty big one!)</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
</pre><td class="rouge-code"><pre>
<span class="kt">void</span> <span class="nf">FUN_082ca72e</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">char</span> <span class="n">cVar1</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">input_code</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">bVar2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iVar3</span><span class="p">;</span>
  <span class="n">undefined1</span> <span class="o">*</span><span class="n">pwd_dest</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">puVar4</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">puVar5</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar6</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">unaff_r8</span><span class="p">;</span>
  <span class="n">byte</span> <span class="o">*</span><span class="n">unaff_r10</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">in_stack_0000000c</span><span class="p">;</span>
  
<span class="nl">code_r0x082ca72e:</span>
  <span class="n">FUN_082da814</span><span class="p">();</span>
  <span class="n">input_related</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_0300097c</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DAT_0300097e</span><span class="p">);</span>
  <span class="n">FUN_082ca100</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004644</span> <span class="o">!=</span> <span class="sc">'\x06'</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">FUN_082caf8c</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="n">DAT_03004650</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="n">DAT_03004650</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="n">DAT_03004650</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">DAT_03004651</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="k">goto</span> <span class="n">LAB_082ca812</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="n">DAT_03004651</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">LAB_082ca812</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">LAB_082ca82c:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in_stack_0000000c</span> <span class="o">&lt;</span> <span class="mh">0x1e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"Wrong PassWord"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"              "</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="n">DAT_03004651</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nl">LAB_082ca812:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082ca82c</span><span class="p">;</span>
    <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"Enter PassWord"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">300</span> <span class="o">&lt;</span> <span class="n">unaff_r8</span> <span class="o">+</span> <span class="mi">1U</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;</span> <span class="n">PWD_LEN_CNT</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_02006cfc</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">DAT_02006d00</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
    <span class="n">FUN_082ca39c</span><span class="p">();</span>
    <span class="n">FUN_082d5b04</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span><span class="mh">0xf</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">iVar3</span> <span class="o">=</span> <span class="n">FUN_082d5b44</span><span class="p">(),</span> <span class="n">iVar3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">FUN_082da814</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">FUN_082ca514</span><span class="p">();</span>
    <span class="n">FUN_082d5b04</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span><span class="mh">0xf</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">iVar3</span> <span class="o">=</span> <span class="n">FUN_082d5b44</span><span class="p">(),</span> <span class="n">iVar3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">FUN_082da814</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">FUN_082cbd4c</span><span class="p">();</span>
    <span class="k">goto</span> <span class="n">code_r0x082ca72e</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
        <span class="n">input_code</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caabe</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xb</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xc</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">goto</span> <span class="n">LAB_082caabe</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="p">(</span><span class="o">&amp;</span><span class="n">PASSCODE_DEST</span><span class="p">)[</span><span class="n">PWD_LEN_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xd</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xe</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                  <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                  <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
                  <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                  <span class="n">input_code</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
<span class="nl">LAB_082caabe:</span>
      <span class="o">*</span><span class="n">pwd_dest</span> <span class="o">=</span> <span class="n">input_code</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">LAB_082caac0:</span>
    <span class="p">(</span><span class="o">&amp;</span><span class="n">PWD_CHAR_1</span><span class="p">)[</span><span class="n">PWD_LEN_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">PWD_LEN_CNT</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="n">PWD_LEN_CNT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">play_gax_speech_effect</span><span class="p">(</span><span class="mh">0x50</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">PWD_LEN_CNT</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">||</span>
       <span class="p">(</span><span class="n">bVar2</span> <span class="o">=</span> <span class="n">check_password_1</span><span class="p">(</span><span class="n">PASSCODE_DEST</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_1</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_2</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_3</span><span class="p">,</span>
                                 <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_4</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_5</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_6</span><span class="p">),</span> <span class="n">bVar2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
    <span class="n">FUN_08000680</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d08</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">password_check</span><span class="p">(</span><span class="n">PASSCODE_DEST</span><span class="p">,</span><span class="n">PWD_CHAR_1</span><span class="p">,</span><span class="n">PWD_CHAR_2</span><span class="p">,</span><span class="n">PWD_CHAR_3</span><span class="p">);</span>
    <span class="n">DAT_03004680</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">calls_pw_print</span><span class="p">();</span>
    <span class="n">unaff_r8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">in_stack_0000000c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_PARSING_RESULT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">undefined</span> <span class="o">*</span><span class="p">)(</span><span class="n">DAT_02006cfc</span> <span class="o">+</span> <span class="mh">0x1b0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">code_r0x082ca72e</span><span class="p">;</span>
   
   <span class="c1">// SEE APPENDIX FOR ENTIRE SUBROUTINE</span>

</pre></table></code></div></div><p>One of the first things that we notice when looking at this function is a large series of if statements assign a value (labeled <code class="language-plaintext highlighter-rouge">input_code</code>) to a memory location pointed to by the variable that I have named <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code>. If we examine the values for the various <code class="language-plaintext highlighter-rouge">input_code</code> assignments, we see that the highest one is <code class="language-plaintext highlighter-rouge">0x12</code>. Why is this number significant? Remember that <code class="language-plaintext highlighter-rouge">0x11</code> possible characters can be entered from the password screen!</p><p><strong>But wait!</strong> We see a <code class="language-plaintext highlighter-rouge">0x12</code> get assigned, but only <code class="language-plaintext highlighter-rouge">0x11</code> possible values available? Correct, the input codes are indexed at <code class="language-plaintext highlighter-rouge">1</code> and not <code class="language-plaintext highlighter-rouge">0</code>, so this still adds up!</p><p>These values likely correspond with the character entered in the password screen, but how are they determined? We can see from the if statement that two variables determine the <code class="language-plaintext highlighter-rouge">input_code</code> which is later stored at the <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code> location: <code class="language-plaintext highlighter-rouge">DAT_03004651</code> and <code class="language-plaintext highlighter-rouge">DAT_03004650</code>. Let’s fire up mGBA and examine these memory values as we enter a password. We will also inspect the <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code> memory location and <code class="language-plaintext highlighter-rouge">PWD_LEN_CNT</code> and see how they are used.</p><p>If “A” is selected in the password screen, both locations are <code class="language-plaintext highlighter-rouge">0</code>, see the memory view below:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/passwd_select_1.png" alt="Password Select 1" /></p><p>If “B” is selected, we see the following:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/passwd_select_2.png" alt="Password Select 2" /></p><p>If H is selected, we see:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/passwd_select_3.png" alt="Password Select 3" /></p><p>See the pattern yet? The values at these two memory locations represent the X and Y coordinates for the current character selection. These X and Y coordinates are then translated and used to assign the <code class="language-plaintext highlighter-rouge">input_code</code> value that eventually gets stored at <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code>.</p><p>For example, let’s examine the following code segment:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
    <span class="n">input_code</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">LAB_082caabe</span><span class="p">;</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>This means that if we enter an “A” , the actual value stored in memory at <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code> is 10. We can verify this by entering 5 A’s and examining memory at the address pointed to by <code class="language-plaintext highlighter-rouge">PASSCODE_DEST</code>, which before I labeled it was <code class="language-plaintext highlighter-rouge">DAT_030027e0</code>.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/all_as.png" alt="Password Entered" /></p><p>Excellent! Here we can see that 5 0xA’s were stored at this address. So with this information, we can generate a table of what character values map to which input codes. The table can be seen below:</p><div class="table-wrapper"><table><thead><tr><th>Character<th>Code<tbody><tr><td>A<td>0xA<tr><td>B<td>0x1<tr><td>C<td>0xB<tr><td>D<td>0x2<tr><td>E<td>0xC<tr><td>F<td>0x3<tr><td>G<td>0x4<tr><td>H<td>0xD<tr><td>I<td>0xE<tr><td>J<td>0x5<tr><td>K<td>0xf<tr><td>L<td>0x6<tr><td>M<td>0x7<tr><td>N<td>0x10<tr><td>O<td>0x11<tr><td>P<td>0x8<tr><td>Q<td>0x12</table></div><p>At this point in our analysis, we have identified the following:</p><ol><li>Which function seems to be handling the password input verification<li>Memory locations for the codes representing the entered password</ol><p>So how are these memory locations used? What happens after a password is entered? Let’s look at the original reason that we visited this subroutine. To begin with, the comparison against 7:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="k">if</span> <span class="p">((</span><span class="n">PWD_LEN_CNT</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">||</span>
    <span class="p">(</span><span class="n">bVar2</span> <span class="o">=</span> <span class="n">check_password_1</span><span class="p">(</span><span class="n">PASSCODE_DEST</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_1</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_2</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_3</span><span class="p">,</span>
                                <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_4</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_5</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_6</span><span class="p">),</span> <span class="n">bVar2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span>
<span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
</pre></table></code></div></div><p>We can see that if <code class="language-plaintext highlighter-rouge">PWD_LEN_COUNT</code> is not equal to seven, or the function that I have labeled <code class="language-plaintext highlighter-rouge">check_password_1</code> returns something not equal to 1 we branch to <code class="language-plaintext highlighter-rouge">LAB_082cac06</code>, this location ultimately returns us to the top of the password processing loop.</p><p>So we want to make sure that when we enter our 7 character password, the <code class="language-plaintext highlighter-rouge">check_password_1</code> function returns a 1. After that, there are several functions called which perform further processing on the user-provided password.</p><p>Before we dig into <code class="language-plaintext highlighter-rouge">check_password_1</code> we should get a solid understanding of what is being passed to it. While the decompilation, in this case, looks very reasonable, it never hurts to verify against the assembly. If we look at the assembly code leading up to the function call for <code class="language-plaintext highlighter-rouge">check_password_1</code> we see the following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre>                             LAB_082caae4                                    XREF[1]:     082caae0(j)  
        082caae4 22 4d           ldr        r5,[-&gt;PASSCODE_DEST]                             = 030027e0
        082caae6 28 78           ldrb       r0,[r5,#0x0]=&gt;PASSCODE_DEST                      This is R0...
        082caae8 69 78           ldrb       r1,[r5,#0x1]=&gt;PWD_CHAR_1                         This is R1
        082caaea aa 78           ldrb       r2,[r5,#0x2]=&gt;PWD_CHAR_2                         This is R2
        082caaec eb 78           ldrb       r3,[r5,#0x3]=&gt;PWD_CHAR_3                         This is R3
        082caaee 2c 79           ldrb       r4,[r5,#0x4]=&gt;PWD_CHAR_4
        082caaf0 00 94           str        r4,[sp,#0x0]=&gt;param_5
        082caaf2 6c 79           ldrb       r4,[r5,#0x5]=&gt;PWD_CHAR_5
        082caaf4 01 94           str        r4,[sp,#param_6]
        082caaf6 ac 79           ldrb       r4,[r5,#0x6]=&gt;PWD_CHAR_6
        082caaf8 02 94           str        r4,[sp,#param_7]
        082caafa 01 f0 39 ff     bl         check_password_1                                 byte check_password_1(byte param

</pre></table></code></div></div><p>We can see from this assembly snippet that the first four characters are being passed through <code class="language-plaintext highlighter-rouge">r0</code>-<code class="language-plaintext highlighter-rouge">r3</code>. The other three characters are passed in on the stack. We can set a breakpoint using <a href="https://wrongbaud.github.io/posts/ghidra-debugger/">our gdb setup from the previous post</a> and dump the register/stack content to verify this. Here is the register/stack content with 7 <code class="language-plaintext highlighter-rouge">G</code>’s are entered:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre>(gdb) info reg
r0             0x4                 4
r1             0x4                 4
r2             0x4                 4
r3             0x4                 4
r4             0x4                 4
r5             0x30027e0           50341856
r6             0x30027e8           50341864
r7             0x3004654           50349652
r8             0x0                 0
r9             0x7                 7
r10            0x3004653           50349651
r11            0x0                 0
r12            0x264               612
sp             0x3007bc0           0x3007bc0
lr             0x82caaff           137145087
pc             0x82cc970           0x82cc970
cpsr           0x6000003f          1610612799
(gdb) x/10w $sp
0x3007bc0:      4       4       4       0
0x3007bd0:      0       0       0       -1
0x3007be0:      0       0
(gdb) 
</pre></table></code></div></div><p>Excellent, we can see that as expected r0-r3 contain 0x4 which is the input_code for the character G. This value is also seen on the stack three times. Now let’s examine the <code class="language-plaintext highlighter-rouge">check_password_1</code> function and see what it contains:</p><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
</pre><td class="rouge-code"><pre><span class="n">byte</span> <span class="nf">check_password_1</span><span class="p">(</span><span class="n">byte</span> <span class="n">param_1</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_2</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_3</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_4</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_5</span><span class="p">,</span><span class="n">uint</span> <span class="n">param_6</span><span class="p">,</span>
                     <span class="n">uint</span> <span class="n">param_7</span><span class="p">)</span>

<span class="p">{</span>
  <span class="n">uint</span> <span class="n">uVar1</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar2</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar3</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">bVar4</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">password_counter</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_3</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_4</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_5</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_6</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar5</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar6</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar7</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar8</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar9</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar10</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">passwd_nonce</span> <span class="p">[</span><span class="mi">8</span><span class="p">];</span>
  <span class="n">undefined</span> <span class="n">return_value</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_30</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_2c</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">local_28</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">nonce_val</span><span class="p">;</span>
  
  <span class="n">passwd_byte_2</span> <span class="o">=</span> <span class="n">param_2</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">passwd_byte_3</span> <span class="o">=</span> <span class="n">param_3</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">passwd_byte_4</span> <span class="o">=</span> <span class="n">param_4</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">passwd_byte_5</span> <span class="o">=</span> <span class="n">param_5</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">passwd_byte_6</span> <span class="o">=</span> <span class="n">param_6</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">passwd_byte_7</span> <span class="o">=</span> <span class="n">param_7</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="n">bVar4</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">local_30</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">local_2c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="cm">/* First thing that we see here is that all of the values have to be less than
                       8?
                        */</span>
  <span class="n">local_28</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(((((</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">param_1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_2</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_3</span><span class="p">))</span> <span class="o">||</span>
      <span class="p">((</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_4</span> <span class="o">||</span> <span class="p">(</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_5</span><span class="p">))))</span> <span class="o">||</span> <span class="p">((</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_6</span> <span class="o">||</span> <span class="p">(</span><span class="mi">8</span> <span class="o">&lt;</span> <span class="n">passwd_byte_7</span><span class="p">))))</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
                    <span class="cm">/* Starts with B
                       If it starts with B, then the return value (1) is stored in local_3a */</span>
  <span class="n">return_value</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                    <span class="cm">/* Return value (1) stored here */</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with D */</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_1</span><span class="p">;</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
      <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with F */</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_1</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with G */</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_1</span><span class="p">;</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with J */</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">param_1</span><span class="p">;</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with L */</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
              <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
              <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
              <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                    <span class="cm">/* Starts with M */</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">==</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">param_1</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082ccad8</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
                <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
            <span class="n">return_value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="n">passwd_nonce</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">return_value</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="nl">LAB_082ccad8:</span>
  <span class="n">password_counter</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">uVar5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">uVar7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">uVar9</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">nonce_val</span> <span class="o">=</span> <span class="n">passwd_nonce</span><span class="p">[</span><span class="n">password_counter</span><span class="p">];</span>
    <span class="n">uVar6</span> <span class="o">=</span> <span class="n">uVar5</span><span class="p">;</span>
    <span class="n">uVar8</span> <span class="o">=</span> <span class="n">uVar7</span><span class="p">;</span>
    <span class="n">uVar10</span> <span class="o">=</span> <span class="n">uVar9</span><span class="p">;</span>
    <span class="n">uVar1</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">;</span>
    <span class="n">uVar2</span> <span class="o">=</span> <span class="n">local_2c</span><span class="p">;</span>
    <span class="n">uVar3</span> <span class="o">=</span> <span class="n">local_28</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\0'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(((((</span><span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
           <span class="p">(</span><span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
          <span class="p">((</span><span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
           <span class="p">(</span><span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))))</span> <span class="o">&amp;&amp;</span>
         <span class="p">(</span><span class="n">uVar10</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">uVar10</span> <span class="o">=</span> <span class="n">uVar9</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\x01'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(((</span><span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
           <span class="p">(((</span><span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span>
             <span class="p">((</span><span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
              <span class="p">(</span><span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))))</span> <span class="o">&amp;&amp;</span>
            <span class="p">(</span><span class="n">uVar1</span> <span class="o">=</span> <span class="n">local_30</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))))</span> <span class="p">{</span>
          <span class="n">uVar1</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\x02'</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(((</span><span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
             <span class="p">((</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span>
              <span class="p">(((</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
               <span class="p">(</span><span class="n">uVar2</span> <span class="o">=</span> <span class="n">local_2c</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))))))</span> <span class="p">{</span>
            <span class="n">uVar2</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\x03'</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">((((</span><span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
               <span class="p">(((</span><span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
                 <span class="p">(</span><span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                <span class="p">(</span><span class="n">uVar8</span> <span class="o">=</span> <span class="n">uVar7</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))))</span> <span class="p">{</span>
              <span class="n">uVar8</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\x04'</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">((((</span><span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                  <span class="p">((</span><span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span>
                   <span class="p">((</span><span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span>
                    <span class="p">(</span><span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))))))</span> <span class="o">&amp;&amp;</span>
                 <span class="p">(</span><span class="n">uVar3</span> <span class="o">=</span> <span class="n">local_28</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">uVar3</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">((((</span><span class="n">nonce_val</span> <span class="o">==</span> <span class="sc">'\x05'</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_2</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                  <span class="p">((</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_3</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span>
                   <span class="p">(((</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_4</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">3</span> <span class="o">&amp;&amp;</span>
                     <span class="p">(</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
                    <span class="p">(</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_6</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))))))</span> <span class="o">&amp;&amp;</span>
                 <span class="p">(</span><span class="n">uVar6</span> <span class="o">=</span> <span class="n">uVar5</span><span class="p">,</span> <span class="n">password_counter</span> <span class="o">==</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">uVar6</span> <span class="o">=</span> <span class="n">passwd_byte_7</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">local_28</span> <span class="o">=</span> <span class="n">uVar3</span><span class="p">;</span>
    <span class="n">local_2c</span> <span class="o">=</span> <span class="n">uVar2</span><span class="p">;</span>
    <span class="n">local_30</span> <span class="o">=</span> <span class="n">uVar1</span><span class="p">;</span>
    <span class="n">password_counter</span> <span class="o">=</span> <span class="n">password_counter</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="n">uVar5</span> <span class="o">=</span> <span class="n">uVar6</span><span class="p">;</span>
    <span class="n">uVar7</span> <span class="o">=</span> <span class="n">uVar8</span><span class="p">;</span>
    <span class="n">uVar9</span> <span class="o">=</span> <span class="n">uVar10</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">password_counter</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(((((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">))))</span> <span class="o">&amp;&amp;</span>
      <span class="p">((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">3</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">6</span><span class="p">))))</span> <span class="o">&amp;&amp;</span>
     <span class="p">((((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">4</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))</span> <span class="o">&amp;&amp;</span>
       <span class="p">((((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">5</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">6</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">))))</span> <span class="o">&amp;&amp;</span>
        <span class="p">((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">7</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">))))))</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">uVar10</span> <span class="o">!=</span> <span class="mi">8</span> <span class="o">||</span> <span class="p">(</span><span class="n">uVar8</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))))))</span> <span class="p">{</span>
    <span class="n">bVar4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">local_30</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">!=</span> <span class="n">local_28</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bVar4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="mi">8</span> <span class="o">-</span> <span class="n">local_2c</span> <span class="o">!=</span> <span class="n">uVar6</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">bVar4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="n">bVar4</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Here we have another lengthy subroutine, but there is an interesting check at the beginning:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>  if (((((8 &lt; param_1) || (8 &lt; passwd_byte_2)) || (8 &lt; passwd_byte_3)) ||
      ((8 &lt; passwd_byte_4 || (8 &lt; passwd_byte_5)))) || ((8 &lt; passwd_byte_6 || (8 &lt; passwd_byte_7))))
  {
    return 0;
  }
</pre></table></code></div></div><p>It would appear that <em>all</em> valid passwords have to contain coded values less than 8! This means that the following characters are the <em>only</em> good characters for a password:</p><div class="table-wrapper"><table><thead><tr><th>Character<th>Code<tbody><tr><td>B<td>0x1<tr><td>D<td>0x2<tr><td>F<td>0x3<tr><td>G<td>0x4<tr><td>J<td>0x5<tr><td>L<td>0x6<tr><td>M<td>0x7</table></div><p>Next, we can see that based on the first character in the password, an array that I have labeled <code class="language-plaintext highlighter-rouge">passwd_nonce</code> is populated with values <code class="language-plaintext highlighter-rouge">0-6</code>, this array is then iterated over in a sizeable do-while loop.</p><p>Let’s regroup here and review how our inputs are processed:</p><ol><li>Letters are mapped to <code class="language-plaintext highlighter-rouge">input_code</code> values based on the X/Y coordinates of the letter that was selected<li>This list of 7 <code class="language-plaintext highlighter-rouge">input_code</code> values is passed to <code class="language-plaintext highlighter-rouge">check_password_1</code><li><code class="language-plaintext highlighter-rouge">check_password_1</code> populates another array I’ve labeled <code class="language-plaintext highlighter-rouge">passwd_nonce</code> based on the first letter of the provided password.<li>Lots of calculations are performed comparing both the <code class="language-plaintext highlighter-rouge">passwd_nonce</code> array and the original values passed into <code class="language-plaintext highlighter-rouge">check_passwd_1</code></ol><p>The next logical step here would be to analyze these while loops and figure out exactly how all these values are related …</p><p>But wait a minute … we’re supposed to be channeling our favorite kaiju with this post. Would they spend time worrying about details, or would they apply brute force methods?</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://64.media.tumblr.com/75b1ec67a8d075a3cd891f2e8c473a01/6088640a3acbc2ce-b8/s640x960/293917fca6f3a4d1a4a39ef29e8e3a590e417861.gifv" alt="Ghidra Wailing" /></p><p>Remember, we know that only 7 possible values can be provided to this function, and those values themselves must be less than 8. This leaves us with 7^7 possible combinations. Let’s ask ourselves a question that is almost always relevant when reverse engineering: What Would Kong/Godzilla/Ghidra do?</p><p><strong>Brute Force!</strong></p><p>Using Ghidras PCode emulation capabilities, we can emulate this function 7^7 times and record which password combinations allow this function to return 1. But before we dive into that, let’s talk about PCode.</p><h2 id="pcode">PCode</h2><p>PCode is a language defined within Ghidra that is used to model processor behavior. This language describes what instructions <em>do</em> and how they affect the CPU and its memory space. In the same way that a hardware design language models how a CPU operates logically, PCode is used to define how instructions work via a <a href="https://ghidra.re/courses/languages/html/pcodedescription.html">predetermined set of operators</a>. <a href="https://ghidra.re/courses/languages/html/pcoderef.html">The documentation</a> refers to it as a register transfer language, and you can also think of it as an Intermediate Language (IL). The PCode for a given instruction defines precisely what the instruction <em>does</em>. For example, if we examine the PCode for the ARM instruction <code class="language-plaintext highlighter-rouge">MOV r8,r1</code> we see the following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    r8 = COPY r1 // This is the PCode
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">COPY</code> is one of the many available PCode operations used to define instruction behavior, and this specific PCode example copies the value of r1 into r8, which is precisely what the <code class="language-plaintext highlighter-rouge">MOV r8,r1</code> instruction does!</p><p><a href="https://ghidra.re/courses/languages/html/sleigh.html">Sleigh</a> is used to define a processor and translate machine code instructions into a sequence of PCode operations. These PCode operations attempt to model the processor’s behavior and serve as an intermediate language that can be analyzed across each CPU architecture that Ghidra supports. This is why the decompiler works across multiple architectures because it is the PCode that is being analyzed instead of the assembly language itself.</p><p>Sleigh defines the actual decoding of the instruction, which is used to generate the disassembly that we can see in the listing view. For each decoded instruction, there is a PCode representation that defines how that specific instruction behaves. For example, if we look at the sleigh file for the 6502 processor, we see the following:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>:AND OP1     is (cc=1 &amp; aaa=1) ... &amp; OP1
{ 
	A = A &amp; OP1; 
	resultFlags(A);
}
</pre></table></code></div></div><p>The first line: <code class="language-plaintext highlighter-rouge">:AND OP1 is (cc=1 &amp; aaa=1) ... &amp; OP1</code> is used to decode the actual instruction and formats the listing display. The code contained in the brackets is the actual PCode, which in this case defines the <code class="language-plaintext highlighter-rouge">AND</code> instruction behavior for the 6502 processor. This instruction performs a logical AND operation on register A and stores the result in A.</p><p>When the analysis is performed, the SLEIGH file is used to decode the instruction, then the PCode is generated. This PCode is then analyzed by the decompiler, which then generates our decompiler output. If you want to examine the PCode in the memory listing, click the following icon at the top of the listing display:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/icon_listing.png" alt="Icon" /></p><p>After that, enable the PCode display by right-clicking the PCode bar and clicking enable:</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/pcode_enable.png" alt="PCode" /></p><p><strong>Note:</strong> I would not recommend leaving this because it makes the disassembly challenging to read.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/pcode_in_listing.png" alt="PCode" /></p><p>So why do we care about any of this? What does this have to do with our password cracking goals? Ghidra can be used to emulate these PCode operations! This will allow us to emulate a specific segment of PCode with specific register and memory values.</p><p>Using Ghidra’s PCode emulation, we can emulate a subroutine, set breakpoints, and even examine register/memory contents. We will emulate the <code class="language-plaintext highlighter-rouge">check_password_1</code> function with all possible combinations of password values and see which values cause the function to return the value <code class="language-plaintext highlighter-rouge">1</code>. This will be used to generate a list of all possible passwords for this game.</p><h2 id="emulating-pcode">Emulating PCode</h2><p>We will use Ghidra’s PCode emulation to emulate our function of interest with every possible password combination. To do this, we will need to do the following:</p><ol><li>Set up memory values and register values to reflect the password being tested<li>Set a breakpoint on the return instruction and check the return value</ol><p>We know from our breakpoint that we set earlier that the first four characters of the password are passed in <code class="language-plaintext highlighter-rouge">r0</code> through <code class="language-plaintext highlighter-rouge">r3</code> and the other three are passed in on the stack. We also know the state of all of the registers and can set them to the same values we dumped out using GDB.</p><p>Lucky for us, Ghidra’s <code class="language-plaintext highlighter-rouge">EmulatorHelper</code> class has everything we need to properly set up memory. Let’s take a look at the function that I wrote to prepare the memory space before emulation:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre>	<span class="kd">private</span> <span class="kt">void</span> <span class="nf">SetupGBAMemory</span><span class="o">(</span><span class="kt">byte</span> <span class="o">[]</span> <span class="n">passwdVals</span><span class="o">)</span> <span class="o">{</span>
		<span class="c1">// Set our stack pointer value to the same value we examined in GDB</span>
		<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="n">emuHelper</span><span class="o">.</span><span class="na">getStackPointerRegister</span><span class="o">(),</span> <span class="mh">0x3007bc0</span><span class="o">);</span>
		<span class="k">try</span> <span class="o">{</span>
			<span class="c1">// Write the first four characters of our password that we are testing</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r0"</span><span class="o">,</span><span class="n">passwdVals</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r1"</span><span class="o">,</span><span class="n">passwdVals</span><span class="o">[</span><span class="mi">1</span><span class="o">]);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r2"</span><span class="o">,</span><span class="n">passwdVals</span><span class="o">[</span><span class="mi">2</span><span class="o">]);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r3"</span><span class="o">,</span><span class="n">passwdVals</span><span class="o">[</span><span class="mi">3</span><span class="o">]);</span>
			<span class="c1">// Copy values in from the dump obtained in GDB</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r4"</span><span class="o">,</span><span class="mi">4</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r5"</span><span class="o">,</span><span class="mh">0x30027e0</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r6"</span><span class="o">,</span><span class="mh">0x30027e8</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r7"</span><span class="o">,</span><span class="mh">0x3004654</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r8"</span><span class="o">,</span><span class="mh">0x0</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r9"</span><span class="o">,</span><span class="mh">0x7</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r10"</span><span class="o">,</span><span class="mh">0x3004653</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r11"</span><span class="o">,</span><span class="mh">0x0</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"r12"</span><span class="o">,</span><span class="mh">0x264</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"sp"</span><span class="o">,</span> <span class="mh">0x3007bc0</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"lr"</span><span class="o">,</span> <span class="mh">0x82caaff</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"cpsr"</span><span class="o">,</span> <span class="mh">0x6000003f</span><span class="o">);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="s">"CY"</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
			<span class="c1">// Write the last three characters onto the stack</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeStackValue</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="n">passwdVals</span><span class="o">[</span><span class="mi">4</span><span class="o">]);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeStackValue</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="n">passwdVals</span><span class="o">[</span><span class="mi">5</span><span class="o">]);</span>
			<span class="n">emuHelper</span><span class="o">.</span><span class="na">writeStackValue</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="n">passwdVals</span><span class="o">[</span><span class="mi">6</span><span class="o">]);</span>
		<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
			<span class="c1">// TODO Auto-generated catch block</span>
			<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
		<span class="o">}</span>
	<span class="o">}</span>
</pre></table></code></div></div><p>The two functions that we use here are:</p><ul><li><code class="language-plaintext highlighter-rouge">writeRegister</code>: Used to write to a register value for a given emulation context<li><code class="language-plaintext highlighter-rouge">writeStackValue</code>: Used to write to a value on the stack</ul><p>After calling this function, our emuHelper object now has all of the proper memory values populated in order to emulate the <code class="language-plaintext highlighter-rouge">check_password_1</code> function. Now we need to actually emulate it, to do this we will use the following subroutine:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">passwd_crack</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">passwdVals</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span><span class="o">{</span>
    <span class="n">returnAddress</span> <span class="o">=</span> <span class="n">getAddress</span><span class="o">(</span><span class="mh">0x82cccba</span><span class="o">);</span>
    <span class="n">mainFunctionEntry</span> <span class="o">=</span> <span class="n">getSymbolAddress</span><span class="o">(</span><span class="s">"check_password_1"</span><span class="o">);</span>
    
    <span class="c1">// Obtain entry instruction in order to establish initial processor context</span>
    <span class="nc">Instruction</span> <span class="n">entryInstr</span> <span class="o">=</span> <span class="n">getInstructionAt</span><span class="o">(</span><span class="n">mainFunctionEntry</span><span class="o">);</span>
    <span class="c1">// Instantiate our emulator helper</span>
    <span class="n">emuHelper</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">EmulatorHelper</span><span class="o">(</span><span class="n">currentProgram</span><span class="o">);</span>
    <span class="kt">char</span><span class="o">[]</span> <span class="n">passwdChars</span> <span class="o">=</span> <span class="o">{</span><span class="sc">'B'</span><span class="o">,</span><span class="sc">'D'</span><span class="o">,</span><span class="sc">'F'</span><span class="o">,</span><span class="sc">'G'</span><span class="o">,</span><span class="sc">'J'</span><span class="o">,</span><span class="sc">'L'</span><span class="o">,</span><span class="sc">'M'</span><span class="o">};</span>
    <span class="nc">SetupGBAMemory</span><span class="o">(</span><span class="n">passwdVals</span><span class="o">);</span>
    <span class="n">emuHelper</span><span class="o">.</span><span class="na">writeRegister</span><span class="o">(</span><span class="n">emuHelper</span><span class="o">.</span><span class="na">getPCRegister</span><span class="o">(),</span> <span class="n">mainFunctionEntry</span><span class="o">.</span><span class="na">getOffset</span><span class="o">());</span>
    
    <span class="k">try</span> <span class="o">{</span>
        <span class="n">emuHelper</span><span class="o">.</span><span class="na">setBreakpoint</span><span class="o">(</span><span class="n">returnAddress</span><span class="o">);</span>
        <span class="c1">// Execution loop until return from function or error occurs</span>
        <span class="k">while</span> <span class="o">(!</span><span class="n">monitor</span><span class="o">.</span><span class="na">isCancelled</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">emuHelper</span><span class="o">.</span><span class="na">run</span><span class="o">(</span><span class="n">mainFunctionEntry</span><span class="o">,</span> <span class="n">entryInstr</span><span class="o">,</span> <span class="n">monitor</span><span class="o">);</span>
            <span class="nc">Address</span> <span class="n">executionAddress</span> <span class="o">=</span> <span class="n">emuHelper</span><span class="o">.</span><span class="na">getExecutionAddress</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">monitor</span><span class="o">.</span><span class="na">isCancelled</span><span class="o">())</span> <span class="o">{</span>
                <span class="n">println</span><span class="o">(</span><span class="s">"Emulation cancelled"</span><span class="o">);</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">executionAddress</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">returnAddress</span><span class="o">))</span> <span class="o">{</span>
                <span class="kt">byte</span> <span class="n">retVal</span> <span class="o">=</span> <span class="n">emuHelper</span><span class="o">.</span><span class="na">readRegister</span><span class="o">(</span><span class="s">"r0"</span><span class="o">).</span><span class="na">byteValue</span><span class="o">();</span>
                <span class="k">if</span><span class="o">(</span><span class="n">retVal</span> <span class="o">==</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                    <span class="nc">String</span> <span class="n">password</span> <span class="o">=</span> <span class="s">""</span><span class="o">;</span>
                    <span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="n">x</span><span class="o">&lt;</span><span class="mi">7</span><span class="o">;</span><span class="n">x</span><span class="o">++)</span> <span class="o">{</span>
                        <span class="n">password</span> <span class="o">+=</span> <span class="n">passwdChars</span><span class="o">[</span><span class="n">passwdVals</span><span class="o">[</span><span class="n">x</span><span class="o">]-</span><span class="mi">1</span><span class="o">];</span>
                    <span class="o">}</span>
                    <span class="n">println</span><span class="o">(</span><span class="s">"Valid password found with password Vals: "</span> <span class="o">+</span> <span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">passwdVals</span><span class="o">)</span> <span class="o">+</span> <span class="s">"Password: "</span><span class="o">+</span><span class="n">password</span><span class="o">);</span>
                    <span class="n">bw</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">password</span><span class="o">);</span>
                    <span class="n">bw</span><span class="o">.</span><span class="na">newLine</span><span class="o">();</span>
                <span class="o">}</span>
                <span class="k">return</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">finally</span> <span class="o">{</span>
        <span class="n">emuHelper</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
	

</pre></table></code></div></div><p>Let’s walk through what this subroutine is doing. First, we set the appropriate return address to use as our stop point for the emulator. This will be the return instruction at the end of the <code class="language-plaintext highlighter-rouge">check_password_1</code> function.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>returnAddress = getAddress(0x82cccba);
</pre></table></code></div></div><p>Next, we define the entry point for our emulation. This will be the address of the <code class="language-plaintext highlighter-rouge">check_password_1</code> function and the first instruction in this function.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>mainFunctionEntry = getSymbolAddress("check_password_1");
// Obtain entry instruction in order to establish initial processor context
Instruction entryInstr = getInstructionAt(mainFunctionEntry);
</pre></table></code></div></div><p>After this, we create our <a href="https://ghidra.re/ghidra_docs/api/ghidra/app/emulator/EmulatorHelper.html"><code class="language-plaintext highlighter-rouge">EmulatorHelper</code></a> object and call the <code class="language-plaintext highlighter-rouge">SetupGBAMemory</code> function with the byte array that was provided to this function. Then we set the program counter register to the function entry point:</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>emuHelper = new EmulatorHelper(currentProgram);
SetupGBAMemory(passwdVals);
emuHelper.writeRegister(emuHelper.getPCRegister(), mainFunctionEntry.getOffset());
</pre></table></code></div></div><p>The following <code class="language-plaintext highlighter-rouge">try</code>/<code class="language-plaintext highlighter-rouge">catch</code> block contains the code that will start the emulation, set a breakpoint at our return address, and monitor the emulator for this breakpoint to be executed. If the breakpoint is triggered and the return instruction is being executed, we read out the <code class="language-plaintext highlighter-rouge">r0</code> value and check if it is <code class="language-plaintext highlighter-rouge">1</code>, which would indicate a valid password. If this is the case, then we write the password out to a file for further examination! The important functions to understand here are:</p><ul><li><code class="language-plaintext highlighter-rouge">emuHelper.setBreakpoint(returnAddress)</code>: Sets a breakpoint on our return address<li><code class="language-plaintext highlighter-rouge">emuHelper.run(mainFunctionEntry, entryInstr, monitor);</code>: Launches the emulation, this blocks until execution stops (i.e our breakpoint is hit!)<li><code class="language-plaintext highlighter-rouge">emuHelper.readRegister("r0")</code>: Allows for the reading of register values during PCode emulation<li><code class="language-plaintext highlighter-rouge">emuHelper.getExecutionAddress()</code>: Returns the current execution address of the emulator</ul><p>With this subroutine, we can provide a password to test, set up memory appropriately and then emulate the PCode for our function of interest. We can then check the return value to see if a valid password was provided, if so we record that to a file. So now all we have to do is call this function 7^7 times with each possible password combination. To generate these combinations we’ll use the following subroutine:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="kd">private</span> <span class="kt">void</span> <span class="nf">permute</span><span class="o">(</span><span class="kt">byte</span><span class="o">[]</span> <span class="n">a</span><span class="o">,</span> <span class="kt">int</span> <span class="n">k</span><span class="o">)</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="na">length</span><span class="o">;</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">k</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="o">||</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span><span class="o">)</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nf">IllegalArgumentException</span><span class="o">(</span><span class="s">"Illegal number of positions."</span><span class="o">);</span>
    <span class="kt">int</span><span class="o">[]</span> <span class="n">indexes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">int</span><span class="o">[</span><span class="n">n</span><span class="o">];</span>
    <span class="kt">int</span> <span class="n">total</span> <span class="o">=</span> <span class="o">(</span><span class="kt">int</span><span class="o">)</span> <span class="nc">Math</span><span class="o">.</span><span class="na">pow</span><span class="o">(</span><span class="n">n</span><span class="o">,</span> <span class="n">k</span><span class="o">);</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">passTest</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">};</span>
    <span class="k">while</span> <span class="o">(</span><span class="n">total</span><span class="o">--</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span> <span class="o">-</span> <span class="o">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">k</span><span class="o">);</span> <span class="n">i</span><span class="o">++)</span>
            <span class="n">passTest</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">[</span><span class="n">indexes</span><span class="o">[</span><span class="n">i</span><span class="o">]];</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// Emulate our PCode!</span>
            <span class="n">passwd_crack</span><span class="o">(</span><span class="n">passTest</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="c1">// TODO Auto-generated catch block</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">indexes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">&gt;=</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">indexes</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="n">indexes</span><span class="o">[</span><span class="n">i</span><span class="o">]++;</span>
                <span class="k">break</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Finally, we can wrap all of this up in our main run function:</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="kd">protected</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
    <span class="n">println</span><span class="o">(</span><span class="s">"Kong Emulation Script Starting..."</span><span class="o">);</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileWriter</span><span class="o">(</span><span class="s">"/home/wrongbaud/kong-passwords.txt"</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
    <span class="n">bw</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedWriter</span><span class="o">(</span><span class="n">fw</span><span class="o">);</span>
    <span class="kt">byte</span><span class="o">[]</span> <span class="n">chars</span> <span class="o">=</span> <span class="o">{</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">4</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">6</span><span class="o">,</span><span class="mi">7</span><span class="o">};</span>
    <span class="n">permute</span><span class="o">(</span><span class="n">chars</span><span class="o">,</span> <span class="mi">7</span><span class="o">);</span>
    <span class="n">bw</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>Let’s run it! We can select our <code class="language-plaintext highlighter-rouge">KongBruteForce.java</code> script from the Scripts window and let it wreak havoc on this binary.</p><div class="language-plaintext highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre>KongBruteForce.java&gt; Kong Emulation Script Starting...
KongBruteForce.java&gt; 2021/04/22 23:32:45
KongBruteForce.java&gt; Kong Emulation Script Ending...found 882 passwords
KongBruteForce.java&gt; 2021/04/23 01:34:46
KongBruteForce.java&gt; Finished!
</pre></table></code></div></div><p>Success! It looks like we have generated <a href="https://github.com/wrongbaud/ghidra-utils/blob/main/GBA/kong-passwords.txt">882 valid passcodes</a> for this game! They appear to be level select cheats, with variations on the playable characters and the number of provided lives. I have not taken the time to analyze every one of them, so some may have repeated functionality. Here are some examples that spawn a Kong level with a varying amount of lives:</p><p>Result of passcode LBMDJBM <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/7_lives.png" alt="7 Lives" /></p><p>Result of passcode GJJBGBM <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/4_lives.png" alt="4 Lives" /></p><p>Result of Passcode GLJBFBM <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7 " data-src="https://wrongbaud.github.io/assets/img/kong/3_lives.png" alt="7 Lives" /></p><p>I have attached the <a href="https://github.com/wrongbaud/ghidra-utils/blob/main/GBA/kong-passwords.txt">codes</a> at the end of this post. There are a <em>lot</em> that I haven’t tested, so have fun. We have 882 passcodes for the GBA ROM Kong: King of Atlantis!</p><h2 id="conclusion">Conclusion</h2><p>This was a much longer post than I anticipated. Thank you for taking the time to read it. I hope you enjoyed my ramblings about GBA ROM reversing and hopefully learned a little something about extending Ghidra along the way.</p><p>With this exercise, we learned:</p><ul><li>How to write Ghidra scripts in Java<li>Steps to determine whether code is valid or not<li>How to write PCode emulation harness in Java and perform PCode emulation</ul><p>Using these techniques, we were able to identify the function containing the password parsing and verification. Once these were identified, we developed a PCode emulation harness to brute force all 823543 possible password combinations. I think that it’s safe to say that Ghidra beat Kong this time. <a href="https://github.com/wrongbaud/ghidra-utils/blob/main/GBA/kong-passwords.txt">Here are all 882 available passwords for the ROM</a>]. All of the scripts that were developed for this work <a href="https://github.com/wrongbaud/ghidra-utils">can be found in my ghidra-utils repository</a>.</p><p>All of the scripts used here can be found in my <a href="https://github.com/wrongbaud/ghidra-utils">ghidra-utils</a> repository. I plan on updating this with scripts that I write throughout these posts and with links to other helpful Ghidra resources. All pull requests are welcome!</p><p>If you would like to learn more about Ghidra, check out <a href="https://hackaday.io/course/172292-introduction-to-reverse-engineering-with-ghidra">this free course</a> that I put together with HackadayU. If you want to learn more about reverse engineering embedded systems and extend Ghidra to analyze the code that runs on them <a href="https://www.voidstarsec.com/hardware-training">my courses through VoidStar Security</a> may be of interest to you. Lastly, if you have any questions about this post or want to reach out, please feel free to do so on <a href="https://twitter.com/wrongbaud">Twitter</a> or at contact@voidstarsec.com</p><h2 id="appendix">Appendix</h2><h3 id="password-parsing-function">Password Parsing Function</h3><div class="language-c highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
</pre><td class="rouge-code"><pre>
<span class="kt">void</span> <span class="nf">FUN_082ca72e</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>

<span class="p">{</span>
  <span class="kt">char</span> <span class="n">cVar1</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="n">input_code</span><span class="p">;</span>
  <span class="n">byte</span> <span class="n">bVar2</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">iVar3</span><span class="p">;</span>
  <span class="n">undefined1</span> <span class="o">*</span><span class="n">pwd_dest</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">puVar4</span><span class="p">;</span>
  <span class="n">undefined</span> <span class="o">*</span><span class="n">puVar5</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">uVar6</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">unaff_r8</span><span class="p">;</span>
  <span class="n">byte</span> <span class="o">*</span><span class="n">unaff_r10</span><span class="p">;</span>
  <span class="n">uint</span> <span class="n">in_stack_0000000c</span><span class="p">;</span>
  
<span class="nl">code_r0x082ca72e:</span>
  <span class="n">FUN_082da814</span><span class="p">();</span>
  <span class="n">input_related</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_0300097c</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DAT_0300097e</span><span class="p">);</span>
  <span class="n">FUN_082ca100</span><span class="p">();</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004644</span> <span class="o">!=</span> <span class="sc">'\x06'</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">FUN_082caf8c</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x10</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">4</span> <span class="o">&lt;</span> <span class="n">DAT_03004650</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x20</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
      <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="n">DAT_03004650</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="n">DAT_03004650</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x80</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="n">DAT_03004651</span><span class="p">))</span> <span class="o">||</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mh">0x40</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">0</span><span class="p">))</span> <span class="k">goto</span> <span class="n">LAB_082ca812</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="n">DAT_03004651</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">LAB_082ca812</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">LAB_082ca82c:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">in_stack_0000000c</span> <span class="o">&lt;</span> <span class="mh">0x1e</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"Wrong PassWord"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"              "</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="n">DAT_03004651</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="nl">LAB_082ca812:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082ca82c</span><span class="p">;</span>
    <span class="n">draw_string</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">"Enter PassWord"</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">unaff_r8</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="mi">300</span> <span class="o">&lt;</span> <span class="n">unaff_r8</span> <span class="o">+</span> <span class="mi">1U</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">PWD_CHAR_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="mi">7</span> <span class="o">&lt;</span> <span class="n">PWD_LEN_CNT</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(((</span><span class="n">DAT_0300097e</span> <span class="o">&amp;</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_02006cfc</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">==</span> <span class="n">DAT_02006d00</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
    <span class="n">FUN_082ca39c</span><span class="p">();</span>
    <span class="n">FUN_082d5b04</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span><span class="mh">0xf</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">iVar3</span> <span class="o">=</span> <span class="n">FUN_082d5b44</span><span class="p">(),</span> <span class="n">iVar3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">FUN_082da814</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">FUN_082ca514</span><span class="p">();</span>
    <span class="n">FUN_082d5b04</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mh">0xc0</span><span class="p">,</span><span class="mh">0xf</span><span class="p">);</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">iVar3</span> <span class="o">=</span> <span class="n">FUN_082d5b44</span><span class="p">(),</span> <span class="n">iVar3</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">FUN_082da814</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">FUN_082cbd4c</span><span class="p">();</span>
    <span class="k">goto</span> <span class="n">code_r0x082ca72e</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">((</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
        <span class="n">input_code</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caabe</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xb</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xc</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">goto</span> <span class="n">LAB_082caabe</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="p">(</span><span class="o">&amp;</span><span class="n">PASSCODE_DEST</span><span class="p">)[</span><span class="n">PWD_LEN_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xd</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xe</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                  <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                  <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0xf</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
                  <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                  <span class="n">input_code</span> <span class="o">=</span> <span class="mi">6</span><span class="p">;</span>
                <span class="p">}</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
          <span class="n">input_code</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
            <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x10</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">else</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
              <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
              <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x11</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span>
              <span class="p">}</span>
              <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082caac0</span><span class="p">;</span>
                <span class="n">pwd_dest</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">PASSCODE_DEST</span> <span class="o">+</span> <span class="n">PWD_LEN_CNT</span><span class="p">;</span>
                <span class="n">input_code</span> <span class="o">=</span> <span class="mh">0x12</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
<span class="nl">LAB_082caabe:</span>
      <span class="o">*</span><span class="n">pwd_dest</span> <span class="o">=</span> <span class="n">input_code</span><span class="p">;</span>
    <span class="p">}</span>
<span class="nl">LAB_082caac0:</span>
    <span class="p">(</span><span class="o">&amp;</span><span class="n">PWD_CHAR_1</span><span class="p">)[</span><span class="n">PWD_LEN_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">PWD_LEN_CNT</span> <span class="o">&lt;</span> <span class="mi">7</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="n">PWD_LEN_CNT</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">play_gax_speech_effect</span><span class="p">(</span><span class="mh">0x50</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">PWD_LEN_CNT</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">)</span> <span class="o">||</span>
       <span class="p">(</span><span class="n">bVar2</span> <span class="o">=</span> <span class="n">check_password_1</span><span class="p">(</span><span class="n">PASSCODE_DEST</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_1</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_2</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_3</span><span class="p">,</span>
                                 <span class="p">(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_4</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_5</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_CHAR_6</span><span class="p">),</span> <span class="n">bVar2</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">goto</span> <span class="n">LAB_082cac06</span><span class="p">;</span>
    <span class="n">FUN_08000680</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d08</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">password_check</span><span class="p">(</span><span class="n">PASSCODE_DEST</span><span class="p">,</span><span class="n">PWD_CHAR_1</span><span class="p">,</span><span class="n">PWD_CHAR_2</span><span class="p">,</span><span class="n">PWD_CHAR_3</span><span class="p">);</span>
    <span class="n">DAT_03004680</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="n">calls_pw_print</span><span class="p">();</span>
    <span class="n">unaff_r8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">in_stack_0000000c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004650</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004651</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_4</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_5</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_7</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_CHAR_8</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">PWD_PARSING_RESULT</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="o">*</span><span class="p">(</span><span class="n">undefined</span> <span class="o">*</span><span class="p">)(</span><span class="n">DAT_02006cfc</span> <span class="o">+</span> <span class="mh">0x1b0</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">code_r0x082ca72e</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">PWD_LEN_CNT</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">PWD_LEN_CNT</span> <span class="o">=</span> <span class="n">PWD_LEN_CNT</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="p">(</span><span class="o">&amp;</span><span class="n">PWD_CHAR_1</span><span class="p">)[</span><span class="n">PWD_LEN_CNT</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">LAB_082cac06:</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004651</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
<span class="nl">LAB_082cad1a:</span>
        <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
          <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
          <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
            <span class="k">goto</span> <span class="n">LAB_082cad1a</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span>
            <span class="n">bVar2</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
            <span class="k">goto</span> <span class="n">LAB_082cad38</span><span class="p">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
          <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
      <span class="n">bVar2</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
<span class="nl">LAB_082cad38:</span>
      <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="n">bVar2</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
<span class="nl">LAB_082cacba:</span>
        <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
          <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span>
          <span class="k">goto</span> <span class="n">LAB_082cacba</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
        <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mh">0x20</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x21</span><span class="p">;</span>
    <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x40</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">else</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x60</span><span class="p">;</span>
<span class="nl">LAB_082cac4e:</span>
      <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0x80</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">==</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xa0</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082cac4e</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">DAT_03004650</span> <span class="o">!=</span> <span class="mi">5</span><span class="p">)</span> <span class="k">goto</span> <span class="n">LAB_082cad54</span><span class="p">;</span>
      <span class="n">DAT_03004652</span> <span class="o">=</span> <span class="mh">0xc0</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="o">*</span><span class="n">unaff_r10</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nl">LAB_082cad54:</span>
  <span class="n">uVar6</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">uVar6</span> <span class="o">=</span> <span class="n">uVar6</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">uVar6</span> <span class="o">!=</span> <span class="mi">8</span><span class="p">);</span>
  <span class="k">do</span> <span class="p">{</span>
    <span class="n">cVar1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">uVar6</span> <span class="o">+</span> <span class="mh">0x30027d8</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x01'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
      <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a1d30</span><span class="p">;</span>
<span class="nl">LAB_082caec2:</span>
      <span class="n">FUN_080003fc</span><span class="p">(</span><span class="n">puVar5</span><span class="p">,</span><span class="n">puVar4</span><span class="p">);</span>
      <span class="n">FUN_08000680</span><span class="p">(</span><span class="n">puVar5</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x02'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a2310</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x03'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a28f0</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x04'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a29b0</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x05'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a34b0</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x06'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a3630</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\a'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a3b50</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\b'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a4650</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\n'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a1c70</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\v'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a2250</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">cVar1</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="p">)(</span><span class="n">uVar6</span> <span class="o">+</span> <span class="mh">0x30027d8</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\f'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a2830</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\r'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a2ed0</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x0e'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a2f90</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x0f'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a3570</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x10'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a3c10</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x11'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">puVar5</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
        <span class="n">puVar4</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">DAT_081a4130</span><span class="p">;</span>
        <span class="k">goto</span> <span class="n">LAB_082caec2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">cVar1</span> <span class="o">==</span> <span class="sc">'\x12'</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">FUN_080003fc</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span><span class="o">&amp;</span><span class="n">DAT_081a4710</span><span class="p">);</span>
        <span class="n">FUN_08000680</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="o">&amp;</span><span class="n">PASSCODE_DEST</span><span class="p">)[</span><span class="n">uVar6</span><span class="p">]</span> <span class="o">==</span> <span class="sc">'\x01'</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">store_1_at_r0</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="n">FUN_0800060c</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">FUN_08000408</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d6c</span> <span class="o">+</span> <span class="n">uVar6</span> <span class="o">*</span> <span class="mi">100</span><span class="p">);</span>
    <span class="n">uVar6</span> <span class="o">=</span> <span class="n">uVar6</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">uVar6</span> <span class="o">==</span> <span class="mh">0x10</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">FUN_08000684</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d08</span><span class="p">,</span><span class="n">DAT_03004652</span><span class="p">,</span><span class="o">*</span><span class="n">unaff_r10</span> <span class="o">+</span> <span class="mh">0x3a</span><span class="p">,</span><span class="mh">0x80</span><span class="p">);</span>
      <span class="n">FUN_08000704</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d08</span><span class="p">);</span>
      <span class="n">FUN_08000408</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_02006d08</span><span class="p">);</span>
      <span class="n">FUN_08000684</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_020073ac</span><span class="p">,(</span><span class="n">uint</span><span class="p">)</span><span class="n">PWD_LEN_CNT</span> <span class="o">*</span> <span class="mh">0x10</span> <span class="o">+</span> <span class="mh">0x50</span><span class="p">,</span><span class="mh">0x20</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="n">FUN_08000704</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_020073ac</span><span class="p">);</span>
      <span class="n">store_1_at_r0</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_020073ac</span><span class="p">);</span>
      <span class="n">FUN_08000408</span><span class="p">(</span><span class="o">&amp;</span><span class="n">DAT_020073ac</span><span class="p">);</span>
      <span class="n">FUN_08002e90</span><span class="p">();</span>
                    <span class="cm">/* WARNING: Subroutine does not return */</span>
      <span class="n">FUN_082ca72e</span><span class="p">();</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">while</span><span class="p">(</span> <span class="nb">true</span> <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/ghidra/'>ghidra</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/ghidra/" class="post-tag no-text-decoration" >ghidra</a> <a href="/tags/gba/" class="post-tag no-text-decoration" >gba</a> <a href="/tags/pcode/" class="post-tag no-text-decoration" >pcode</a> <a href="/tags/reversing/" class="post-tag no-text-decoration" >reversing</a> <a href="/tags/firmware/" class="post-tag no-text-decoration" >firmware</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking - Wrongbaud's Blog&url=https://wrongbaud.github.io/posts/kong-vs-ghidra/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking - Wrongbaud's Blog&u=https://wrongbaud.github.io/posts/kong-vs-ghidra/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking - Wrongbaud's Blog&url=https://wrongbaud.github.io/posts/kong-vs-ghidra/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/kong-vs-ghidra/">Godzilla Vs. Kong Vs ... Ghidra? - Ghidra Scripting, PCode Emulation, and Password Cracking</a><li><a href="/posts/ghidra-debugger/">A first look at Ghidra's Debugger - Game Boy Advance Edition</a><li><a href="/posts/Holiday-Teardown/">BasicFUN Series Part 4: I2C Sniffing, EEPROM Extraction and Parallel Flash Extraction</a><li><a href="/posts/BasicFUN-rom-analysis/">BasicFUN Series Part 2: Reverse Engineering Firmware / Reflashing SPI Flash</a><li><a href="/posts/MK-Teardown/">BasicFUN Series Part 3: Dumping Parallel Flash via I2C I/O Expanders</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/ghidra/">ghidra</a> <a class="post-tag" href="/tags/spi/">spi</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/gba/">gba</a> <a class="post-tag" href="/tags/i2c/">i2c</a> <a class="post-tag" href="/tags/nand/">nand</a> <a class="post-tag" href="/tags/nes/">nes</a> <a class="post-tag" href="/tags/firmware/">firmware</a> <a class="post-tag" href="/tags/jtag/">jtag</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/ghidra-debugger/"><div class="card-body"> <span class="timeago small" > Dec 19, 2020 <i class="unloaded">2020-12-19T08:06:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>A first look at Ghidra's Debugger - Game Boy Advance Edition</h3><div class="text-muted small"><p> A first look at Ghidra’s Debugger - Game Boy Advance Edition Overview Yesterday the NSA Twitter account announced that a new branch of Ghidra has been release with the long-awaited debugging capa...</p></div></div></a></div><div class="card"> <a href="/posts/writing-a-ghidra-loader/"><div class="card-body"> <span class="timeago small" > Feb 21, 2020 <i class="unloaded">2020-02-21T08:22:10+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Writing a GHIDRA Loader: STM32 Edition.</h3><div class="text-muted small"><p> Background In my last post, we managed to dump the firmware off of an Xbox One controller by using the Single Wire Debug interface. Now that we have the firmware image as well as the target CPU de...</p></div></div></a></div><div class="card"> <a href="/posts/ghidra-training/"><div class="card-body"> <span class="timeago small" > Jul 30, 2020 <i class="unloaded">2020-07-30T08:06:31+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Introduction to Reverse Engineering with Ghidra: A Four Session Course</h3><div class="text-muted small"><p> Background / Catching Up Over the last few months, those of you who follow my ramblings here have probably noticed a serious lack of content (4 months!). When I started this project I wanted to tr...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ghidra-debugger/" class="btn btn-outline-primary"><p>A first look at Ghidra's Debugger - Game Boy Advance Edition</p></a> <span class="btn btn-outline-primary disabled"><p>-</p></span></div></div></div></div><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script> <script type="text/javascript"> const imgs = document.querySelectorAll('#post-wrapper img'); const observer = lozad(imgs); observer.observe(); </script><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/wrongbaud">wrongbaud</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy/" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-xl-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/hardware/">hardware</a> <a class="post-tag" href="/tags/ghidra/">ghidra</a> <a class="post-tag" href="/tags/spi/">spi</a> <a class="post-tag" href="/tags/tools/">tools</a> <a class="post-tag" href="/tags/gba/">gba</a> <a class="post-tag" href="/tags/i2c/">i2c</a> <a class="post-tag" href="/tags/nand/">nand</a> <a class="post-tag" href="/tags/nes/">nes</a> <a class="post-tag" href="/tags/firmware/">firmware</a> <a class="post-tag" href="/tags/jtag/">jtag</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://wrongbaud.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>' }); </script> <script async src="https://www.googletagmanager.com/gtag/js?id="></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); </script>
